
@{
    ViewBag.Title = "Cars";
    Layout = "~/Views/Shared/Layout.cshtml";
}

<h3 class="font-family avs">
    SilkWay Mashinlar
    <button type="button" class="btn btn-primary ml-sty" style="margin-left:30px;" data-toggle="modal" data-target="#exampleModal" data-whatever="mdo"><i class="fa fa-plus-square" style="padding-right:10px;"></i>Create New</button>
</h3>
<hr />

<div class="modal fade " id="exampleModal" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"> Create new SilkWay Mashinlar  form .. </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <div class="row mm">
                            <div class="col-md-5"><label for="recipient-name" class="col-form-label" style="float:left;">BanCode</label></div>
                            <div class="col-md-7"><input type="text" class="form-control" id="bancode" style="float:left;" /></div>
                        </div>
                        <div class="row mm">
                            <div class="col-md-5"><label for="recipient-name" class="col-form-label" style="float:left;">CarMarka</label></div>
                            <div class="col-md-7">
                                <select class="form-control font-family" id="carmarka">
                                    @{
                                        List<SWCars.Models.DataModels.CarMarka> carmarkalist = (List<SWCars.Models.DataModels.CarMarka>)ViewBag.CarmarkaList;

                                        <option id="cm" class="marka"></option>

                                        foreach (var markalist in carmarkalist)
                                        {
                                            <option id="@markalist.Id" class="marka">@markalist.Marka</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="row mm">
                            <div class="col-md-5"><label class="col-form-label" style="float:left;">CarModel</label></div>
                            <div class="col-md-7">
                                <select class="form-control font-family" id="carmodels">
                                    @{
                                        List<SWCars.Models.DataModels.CarModel> modelList = (List<SWCars.Models.DataModels.CarModel>)ViewBag.CarmodelList;

                                        <option id="cml" class="model"></option>
                                        

                                        foreach (var models in modelList)
                                        {
                                            <option id="@models.Id" class="structure">@models.Model</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="row mm">
                            <div class="col-md-5"><label for="recipient-name" class="col-form-label" style="float:left;">CarNo</label></div>
                            <div class="col-md-7"><input type="text" class="form-control" id="carno" style="float:left;" /></div>
                        </div>
                        <div class="row mm">
                            <div class="col-md-5"><label for="recipient-name" class="col-form-label" style="float:left;">ProductionDate</label></div>
                            <div class="col-md-7"><input type="date" class="form-control" id="proddate" style="float:left;" /></div>
                        </div>
                        <div class="row mm">
                            <div class="col-md-5"><label class="col-form-label" style="float:left;">CarType</label></div>
                            <div class="col-md-7">
                                <select class="form-control font-family" id="cartypes">
                                    @{
                                        List<SWCars.Models.DataModels.CarType> typeList = (List<SWCars.Models.DataModels.CarType>)ViewBag.CartypeList;

                                        <option id="ct" class="type"></option>

                                        foreach (var types in typeList)
                                        {
                                            <option id="@types.Id" class="structure">@types.CarTypeName</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="row mm">
                            <div class="col-md-5"><label class="col-form-label" style="float:left;">OilType</label></div>
                            <div class="col-md-7">
                                <select class="form-control font-family" id="oiltype">
                                    @{
                                        List<SWCars.Models.DataModels.OilType> oiltypelist = (List<SWCars.Models.DataModels.OilType>)ViewBag.OiltypeList;

                                        <option id="ot" class="oiltype"></option>

                                        foreach (var oil in oiltypelist)
                                        {
                                            <option id="@oil.Id" class="structure">@oil.OilTypeName</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
    <!--                   <div class="row mm">
                            <div class="col-md-5"><label class="col-form-label" style="float:left;">OilTypesSpesific</label></div>
                            <div class="col-md-7">
                                <select class="form-control font-family" id="oiltypes">
                                    @{
                                        List<SWCars.Models.DataModels.OilType> oiltypesplist = (List<SWCars.Models.DataModels.OilType>)ViewBag.OiltypeList;

                                        <option id="spot" class="spOiltype"></option>

                                        foreach (var oilsp in oiltypesplist)
                                        {
                                            <option id="@oilsp.Id" class="structure">@oilsp.OilTypeSpesificName</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
         -->               
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="AddButton">Add Car</button>
            </div>
        </div>
    </div>
</div>
<div id="tableDiv">

    @{
        List<SWCars.Models.ViewModels.CarViewModel> Carlist = (List<SWCars.Models.ViewModels.CarViewModel>)ViewBag.CarList;

        if (Carlist == null || Carlist.Count == 0)
        {
            <p class="font-family" style="font-size:17px;">Hec bir telim tapilmadi.</p>
        }
        else
        {
            <table class="table">
                <thead class="thead-light">
                    <tr class="font-family">
                        <th>Bancode</th>
             <!--       <th>Marka</th>        -->
                        <th>Model</th>
                        <th>CarNo</th>
                        <th>CarType</th>
                        <th>OilType</th>
                        <th>ProductionDate</th>                                              
    <!--                <th>OiltypeSpesificname</th>             -->
                        
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Carlist)
                    {
                        string prDate = item.ProductionDate.ToShortDateString();
                        

                            <tr id="@item.Bancode" class="font-family" style="background-color:orange;">
                                <td class='rowCell'>@item.Bancode</td>
                         <!--    <td class='rowCell'>@item.Marka</td>   -->
                                <td class='rowCell'>@item.Model</td>
                                <td class='rowCell'>@item.Carno</td>
                                <td class='rowCell'>@item.CarType</td>
                                <td class='rowCell'>@item.OilType</td>
                                <td class='rowCell'>@prDate</td>
                            <!--  <td class='rowCell'>@item.OiltypeSpesificname</td>       -->
                                
                                
                                
                            </tr>
                        
                    }
                </tbody>
            </table>
        }

    }
</div>


<script src="~/Scripts/jquery-3.3.1.min.js"></script>

<script>
    $(document).ready(function () {

        

        $('button#AddButton').click(function () {

            var Bancode = $('input#bancode').val();
            var Carno = $('input#carno').val();

            var markaId = $('select#carmarka :selected').attr('id');
            var modelId = $('select#carmodels :selected').attr('id');
            var cartypeId = $('select#cartypes :selected').attr('id');
            var oiltypeId = $('select#oiltype :selected').attr('id');
            //  var oiltypespId = $('select#oiltypes:selected').attr('id');
            var productiondates = $('input#proddate').val();

            if (markaId == 'cm') {
                alert('Marka field is empty !');
                return;
            }

            if (modelId == 'cml') {
                alert('model field is empty !');
                return;
            }
            if (Bancode.length == 0) {
                alert('Bancode field is empty !');
                return;
            }

            //if (cartypeid == 'ct')
            //{
            //    alert('car type is empty !');
            //    return;
            //}

            //if (oiltypeId == 'ot') {
            //    alert('oil type is empty !');
            //    return;
            //}

            //if (oiltypespId == 'spot')
            //{
            //    alert('oil type spesific name is empty !');
            //    return;
            //}

            $.ajax({

                type: 'Post',
                url: '@Url.Action("CreatenewCar", "Cars")',
                dataType: 'json',
                data: { Bancode: Bancode, Modelid: modelId, Carno: Carno, Productiondate: productiondates, Cartypeid: cartypeId, Oiltypeid: oiltypeId },
                success: function (func) {
                    if (data.Status == true) {
                        var rowsCount = $("tbody tr").length;
                        var table, rows;

                        var productiondate = productiondate.substring(8, 10) + '.' + productiondate.substring(5, 7) + '.' + productiondate.substring(0, 4);
                        if (rowsCount == 0) {

                            $("p").remove();
                            table = "<table class='table'><thead class='thead-light'><tr class='font-family'><th>Bancode</th><th>Model</th><th>Carno</th><th>Cartype</th><th>Oiltype</th><th>ProductionDate</th></tr></thead>" + "<tbody><tr id=" + func.Message + " class='font-family'><td class='rowCell'>" + Bancode + "</td><td class='rowCell'>" + modelId + "</td><td class='rowCell'>" + Carno + "</td><td class='rowCell'>" + cartypeId + "</td><td class='rowCell'>" + oiltypeId + "</td><td class='rowCell'>" + productiondate + "</td></tr>";
                            $("div#tableDiv").html(table);
                        }
                        else {
 
                            rows = $("tbody").html() + "<tr id=" + func.Message + " class='font-family'><td class='rowCell'>" + Bancode + "</td><td class='rowCell'>" + modelId + "</td><td class='rowCell'>" + Carno + "</td><td class='rowCell'>" + cartypeId + "</td><td class='rowCell'>" + oiltypeId + "</td><td class='rowCell'>" + productiondate + "</td></tr>";
                            $("tbody").html(rows);
                        }

                        $('input#bancode').val('');
                        $('input#carno').val('');
                        $('select#carmodels').val('');
                        $('select#cartypes').val('');
                        $('input#proddate').val('');
                        $('select#oiltype').val('');

                    }
                    else if (func.Status == false) {
                        alert(func.Message);
                    }
                },
                error: function () {

                }
            });
            $('.modal').modal('hide');
        });

    });
</script>



